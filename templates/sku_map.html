
{% extends "layout.html" %}
{% block content %}
<div class="container mt-4">
  <h2>SKU Alias Mapping</h2>
  <form method="POST">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Merge</th>
          <th>Canonical SKU</th>
          <th>Aliases (comma-separated)</th>
          <th>Type</th>
        </tr>
      </thead>
      <tbody>
        {% for entry in grouped %}
        <tr>
          <td class="text-center"><input type="checkbox" name="select_{{ loop.index0 }}" value="{{ entry.canonical }}"></td>
          <td><input class="form-control" type="text" name="canonical_{{ loop.index0 }}" value="{{ entry.canonical }}"></td>
          <td><input class="form-control" type="text" name="aliases_{{ loop.index0 }}" value="{{ entry.aliases }}"></td>
          <td>
            <select class="form-control" name="type_{{ loop.index0 }}">
              <option value="machine" {% if entry.type == 'machine' %}selected{% endif %}>Machine</option>
              <option value="detergent" {% if entry.type == 'detergent' %}selected{% endif %}>Detergent</option>
              <option value="filters" {% if entry.type == 'filters' %}selected{% endif %}>Filters</option>
              <option value="maintenance" {% if entry.type == 'maintenance' %}selected{% endif %}>Maintenance</option>
            </select>
          </td>
        </tr>
        {% endfor %}
        <tr>
          <td></td>
          <td><input class="form-control" type="text" name="canonical_new"></td>
          <td><input class="form-control" type="text" name="aliases_new"></td>
          <td>
            <select class="form-control" name="type_new">
              <option value="machine">Machine</option>
              <option value="detergent">Detergent</option>
              <option value="filters">Filters</option>
              <option value="maintenance">Maintenance</option>
            </select>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="mb-3">
      <label class="form-label">Merge selected into:</label>
      <input class="form-control" type="text" name="merge_target">
    </div>
    <button class="btn btn-secondary me-2" type="submit" name="merge" value="1">Merge Selected</button>
    <button class="btn btn-primary" type="submit" name="save" value="1">Save Changes</button>
  </form>
  {% if suggestions %}
  <h4 class="mt-4">Potential Merges</h4>
  <ul>
    {% for pair in suggestions %}
    <li>
      <form method="POST" class="d-inline">
        <input type="hidden" name="merge_target" value="{{ pair[0] }}">
        <input type="hidden" name="select_0" value="{{ pair[1] }}">
        <button class="btn btn-link p-0" type="submit" name="merge" value="1">Merge {{ pair[1] }} into {{ pair[0] }}</button>
      </form>
    </li>
    {% endfor %}
  </ul>
  {% endif %}
</div>
{% endblock %}
