
{% extends "layout.html" %}
{% block content %}
<div class="card">
  <div class="card-content report-content">
    <h2 class="title is-4">Monthly Report</h2>
    <form method="get" class="mb-4">
      <label class="label">Select Year:</label>
      <div class="select is-inline-block">
        <select name="year" onchange="this.form.submit()">
        {% for y in years %}
        <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}</option>
        {% endfor %}
        </select>
      </div>
    </form>

<h4 class="title is-5">Overall Sales by Month ({{ selected_year }})</h4>
<img src="{{ url_for('report_chart', year=selected_year) }}" class="my-3" alt="Monthly Chart">
<table class="table is-fullwidth is-bordered">
    <thead><tr><th>Month</th><th>{{ selected_year }} $</th><th>{{ selected_year - 1 }} $</th><th>% Change</th></tr></thead>
  <tbody>
    {% for month, current, previous, pct in rows %}
    <tr>
      <td>{{ month }}</td>
      <td>${{ "%.2f"|format(current or 0) }}</td>
      <td>${{ "%.2f"|format(previous or 0) }}</td>
      <td>{{ pct }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<h4 class="title is-5 mt-5">Machine Sales by Month</h4>
<table class="table is-fullwidth is-striped is-narrow">
  <thead><tr><th>SKU</th>{% for m in months %}<th>{{ m }}</th>{% endfor %}<th>Total</th></tr></thead>
  <tbody>
    {% for sku, row in machine_data.items() %}
    <tr>
      <td>{{ sku }}</td>
      {% for m in months %}
      <td>${{ "%.2f"|format(row.get(m, 0)) }} ({{ machine_qty[sku].get(m, 0)|int }})</td>
      {% endfor %}
      <td>${{ "%.2f"|format(row['total']) }} ({{ machine_qty[sku]['total']|int }})</td>
    </tr>
    {% endfor %}
  </tbody>
</table>


<h4 class="title is-5 mt-5">Detergent & Filter Sales by Month</h4>
<table class="table is-fullwidth is-striped is-narrow">
  <thead><tr><th>SKU</th>{% for m in months %}<th>{{ m }}</th>{% endfor %}<th>Total</th></tr></thead>
  <tbody>
    {% for sku, row in chem_data.items() %}
    <tr>
      <td>{{ sku }}</td>
      {% for m in months %}
      <td>${{ "%.2f"|format(row.get(m, 0)) }} ({{ chem_qty[sku].get(m, 0)|int }})</td>
      {% endfor %}
      <td>${{ "%.2f"|format(row['total']) }} ({{ chem_qty[sku]['total']|int }})</td>
    </tr>
    {% endfor %}
  </tbody>
</table>


<div class="has-text-right mt-4">
  <button onclick="window.print()" class="button is-light">üñ®Ô∏è Print Report</button>
  </div>
  </div>
</div>
{% endblock %}
